#----------------------- Filebeat Configuration -----------------------
filebeat.config.modules:
  path: ${path.config}/modules.d/*.yml
  reload.enabled: true

filebeat.inputs:
- type: filestream
  id: nginx-access-logs
  enabled: true
  paths:
    - /var/log/nginx/access.log
  fields:
    service: nginx
    log_type: access
  fields_under_root: true
  close_inactive: 5m

- type: filestream
  id: nginx-error-logs
  enabled: true
  paths:
    - /var/log/nginx/error.log
  fields:
    service: nginx
    log_type: error
  fields_under_root: true
  close_inactive: 5m

output.elasticsearch:
  hosts: ["{{ hostvars['elasticsearch'].ansible_host }}:9200"]
  indices:
    - index: "logs-nginx-access-%{+yyyy.MM.dd}"
      when.equals:
        log_type: "access"
    - index: "logs-nginx-error-%{+yyyy.MM.dd}"
      when.equals:
        log_type: "error"

processors:
  - add_host_metadata: {}
  - add_cloud_metadata: {}